{% extends 'base.html' %}
{% block content %}
<h2>Admin Dashboard</h2>
<p><a href="/logout">Logout</a></p>
<h3>Players</h3>
<form method="post" action="/add_players">
  <textarea name="players" placeholder="One player per line" rows="8" cols="30"></textarea><br>
  <button type="submit">Add/Replace Players</button>
</form>
{% if players %}
<h3>Current Players</h3>
<ul>
  {% for p in players %}
  <li>{{ p }}</li>
  {% endfor %}
</ul>
<form method="post" action="/shuffle">
  <button type="submit">Shuffle into Teams</button>
</form>
{% endif %}
{% if teams %}
<h3>Teams</h3>
<ul id="teams-list">
  {% for t in teams %}
  <li>{{ t.name }}: {{ t.players[0] }} &amp; {{ t.players[1] }}</li>
  {% endfor %}
</ul>
<form method="post" action="/start_match">
  <label>Select Team A:</label>
  <select name="team_a">
    {% for t in teams %}
    <option value="{{ loop.index0 }}">{{ t.name }}</option>
    {% endfor %}
  </select>
  <label>Select Team B:</label>
  <select name="team_b">
    {% for t in teams %}
    <option value="{{ loop.index0 }}">{{ t.name }}</option>
    {% endfor %}
  </select>
  <button type="submit">Start Match</button>
</form>
{% endif %}
{% if current_match %}
<h3>Current Match: {{ current_match.team_a.name }} vs {{ current_match.team_b.name }}</h3>
<div id="scoreboard">
  <div>
    {{ current_match.team_a.name }}: <span id="score_a">{{ current_match.games_a }}</span> games
  </div>
  <div>
    {{ current_match.team_b.name }}: <span id="score_b">{{ current_match.games_b }}</span> games
  </div>
</div>
<form method="post" action="/point/team_a">
  <button type="submit">+1 {{ current_match.team_a.name }}</button>
</form>
<form method="post" action="/point/team_b">
  <button type="submit">+1 {{ current_match.team_b.name }}</button>
</form>
<script>
function updateScore(){
  fetch('/current_match').then(r => r.json()).then(d => {
    if(!d.team_a) return;
    document.getElementById('score_a').textContent = d.games_a;
    document.getElementById('score_b').textContent = d.games_b;
  });
}
setInterval(updateScore, 2000);
</script>
{% endif %}
{% if ranking %}
<h3>Ranking</h3>
<table>
  <tr><th>Team</th><th>Games Won</th></tr>
  {% for r in ranking %}
  <tr><td>{{ r.name }} ({{ r.initials }})</td><td>{{ r.games }}</td></tr>
  {% endfor %}
</table>
{% endif %}
{% if shuffling %}
<script>
const items = document.querySelectorAll('#teams-list li');
let count = 0;
const interval = setInterval(() => {
  items.forEach(li => li.style.color = '#' + Math.floor(Math.random()*16777215).toString(16));
  if (++count > 10) clearInterval(interval);
}, 200);
</script>
{% endif %}
{% endblock %}
